# Video2En 项目总结

## 🎯 项目概述

Video2En 是一个用 Rust 编写的命令行工具，专门用于从视频/音频文件中提取英文字幕。该工具实现了完整的"抽音 → Whisper 识别 → 英文过滤"流程，输出多种格式的字幕文件。

## ✨ 主要功能

### 核心功能
- **音频提取**: 使用 FFmpeg 将视频/音频转换为 16kHz 单声道 WAV 格式
- **语音识别**: 集成 Whisper 模型进行离线语音识别
- **语言过滤**: 智能识别和过滤英文字幕内容
- **多格式输出**: 生成 SRT 字幕文件和纯文本文件

### 输出文件
1. `<prefix>.all.srt` - 全量字幕（包含中英文）
2. `<prefix>.en.srt` - 仅英文字幕
3. `<prefix>.en.txt` - 仅英文纯文本

### 语言支持
- **输入**: 支持中英混杂内容
- **识别**: 自动语言检测 + 手动语言指定
- **过滤**: 双重过滤机制（ASCII 比例 + 语言检测）

## 🏗️ 技术架构

### 依赖库
- **anyhow**: 错误处理
- **clap**: 命令行参数解析
- **hound**: WAV 文件处理
- **lingua**: 语言检测
- **regex**: 文本处理
- **tempfile**: 临时文件管理
- **which**: 系统命令检测

### 核心模块
1. **音频处理模块**: FFmpeg 集成、WAV 读取验证
2. **语音识别模块**: Whisper 模型加载、推理处理
3. **语言过滤模块**: 文本清洗、英文判定
4. **输出生成模块**: SRT 格式化、文件写入

## 📁 项目结构

```
video2en/
├── Cargo.toml          # 项目配置和依赖
├── src/
│   └── main.rs         # 主程序源码
├── target/
│   └── release/
│       └── video2en.exe # Windows 可执行文件
├── README.md            # 使用说明
├── INSTALL.md           # 安装指南
├── test_demo.ps1        # 演示脚本
└── test_data/           # 测试数据目录
```

## 🚀 使用方法

### 基本命令
```powershell
.\target\release\video2en.exe -i <输入文件> -m <模型文件>
```

### 高级选项
```powershell
.\target\release\video2en.exe \
  -i input.mp4 \
  -m models/ggml-small.bin \
  -o output/result \
  --language auto \
  --threads 8 \
  --force
```

## 🔧 安装要求

### 必需组件
- **Rust**: 1.70+ 版本
- **FFmpeg**: 音频处理
- **libclang**: Whisper 编译支持

### 推荐配置
- **操作系统**: Windows 10/11 (x64)
- **内存**: 8GB+ RAM
- **存储**: 2GB+ 可用空间
- **CPU**: 多核心处理器

## 📊 当前状态

### ✅ 已完成
- [x] 项目基础架构
- [x] CLI 参数解析
- [x] FFmpeg 集成
- [x] 音频文件处理
- [x] 语言检测逻辑
- [x] 字幕文件生成
- [x] 英文过滤算法
- [x] 错误处理机制
- [x] 文档和说明

### 🔄 演示模式
- [x] 模拟 Whisper 输出
- [x] 示例字幕生成
- [x] 功能演示

### 🚧 待完善
- [ ] 真实 Whisper 集成（需要 libclang）
- [ ] 性能优化
- [ ] 更多音频格式支持
- [ ] 批量处理功能

## 🎨 特色亮点

### 1. 智能语言过滤
- **双重检测**: ASCII 比例 + 语言识别
- **可配置阈值**: 支持自定义英文判定标准
- **中英混合**: 完美处理混合语言内容

### 2. 用户友好设计
- **清晰错误提示**: 详细的错误信息和解决建议
- **进度显示**: 实时处理状态反馈
- **灵活输出**: 支持自定义输出路径和文件名

### 3. 跨平台兼容
- **Windows 优先**: 针对 Windows 环境优化
- **路径处理**: 智能处理不同操作系统的路径格式
- **依赖检测**: 自动检测系统依赖可用性

## 🔮 未来规划

### 短期目标
- [ ] 集成真实 Whisper 模型
- [ ] 添加更多音频格式支持
- [ ] 优化内存使用

### 长期愿景
- [ ] 支持 GGUF 模型格式
- [ ] 添加 VAD 语音活动检测
- [ ] 实现流式处理
- [ ] 支持更多输出格式

## 📈 性能指标

### 处理能力
- **音频格式**: MP4, MKV, MOV, MP3, WAV 等
- **采样率**: 自动转换为 16kHz
- **声道**: 自动转换为单声道
- **线程**: 支持多线程并行处理

### 输出质量
- **时间精度**: 毫秒级时间戳
- **文本格式**: 标准 SRT 格式
- **编码支持**: UTF-8 编码

## 🤝 贡献指南

### 开发环境
1. 克隆项目仓库
2. 安装 Rust 和依赖
3. 运行 `cargo build` 构建项目
4. 运行 `cargo test` 执行测试

### 代码规范
- 遵循 Rust 编码规范
- 使用 `cargo fmt` 格式化代码
- 使用 `cargo clippy` 检查代码质量

## 📞 支持与反馈

### 问题报告
- 查看 [INSTALL.md](INSTALL.md) 中的故障排除
- 提供详细的错误信息和系统环境
- 包含可重现的测试用例

### 功能建议
- 描述具体使用场景
- 提供示例输入和期望输出
- 考虑实现的复杂度和优先级

---

**项目状态**: 🟡 演示版本 (功能完整，等待 Whisper 集成)  
**最后更新**: 2025年9月  
**维护状态**: 活跃开发中
